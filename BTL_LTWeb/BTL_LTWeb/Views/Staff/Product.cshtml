@model List<BTL_LTWeb.Models.Product>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Staff_Layout.cshtml";
}


<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>Product Id</th>
                <th>Product Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.product_id</td>
                    <td>@item.product_name</td>
                    <td>@item.description.Substring(0, 8)...</td>
                    <td>@(String.Format("{0:0.##}", item.price)) VNĐ</td>
                    <td>
                        <img style="height: 100px; width: 100px " src="~/Assets/staff/Assets/images/@item.image_url" />
                    </td>
                    <td>
                        <button style="display: flex; flex-direction: row; justify-content: center; align-items: flex-start;" type="button" class="btn btn-primary btn-icon-text" onclick="openUpdateModal('@item.product_id')">
                            <i class="mdi mdi-table-edit">

                            </i>
                            <a>Edit</a>
                        </button>

                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div style="color:white" id="updateModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateModalLabel">Edit Product</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="product_id">Product Id:</label>
                            <input type="text" class="form-control" id="product_id" placeholder="Enter product name" readonly style="color: black; cursor: not-allowed; disabled">
                        </div>
                        <div class="form-group">
                            <label for="updateProductName">Product Name:</label>
                            <input type="text" class="form-control" id="updateProductName" placeholder="Enter product name" style="color:white">
                        </div>
                        <div class="form-group">
                            <label for="updateProductDescription">Product Description:</label>
                            <textarea class="form-control" id="updateProductDescription" rows="3" placeholder="Enter product description" style="color: white"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="updateProductPrice">Product Price:</label>
                            <input type="number" class="form-control" id="updateProductPrice" placeholder="Enter product price" readonly style="color: black; cursor: not-allowed; disabled">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <img id="product_img" src="" alt="Product Image" style="width: 100%;height:100%">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>*@
                <button type="submit" class="btn btn-primary" id="updateProductButton" onclick="update()">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
    function openUpdateModal(product_id) {
        // Sử dụng Ajax để lấy thông tin sản phẩm từ server
        $.ajax({
            url: `/api/Staff_API/UpdateProduct?product_id=${product_id}`,
            type: 'GET',
            dataType: 'json',
            success: function (productInfo) {
                // Hiển thị thông tin sản phẩm trong modal
                $('#updateProductName').val(productInfo.product_name);
                $('#updateProductDescription').val(productInfo.description);
                $('#updateProductPrice').val(productInfo.price);
                $('#product_img').attr('src', '/Assets/staff/Assets/images/' + productInfo.image_url);
                $('#product_id').val(productInfo.product_id);
                // Hiển thị modal
                $('#updateModal').modal('show');
            },
            error: function (error) {
                console.error('Error fetching product info:', error);
                // Xử lý lỗi nếu cần
            }
        });
    }

    @*function update() {
        $('#updateProductButton').click(function () {
            // Get product information from the modal form
            var masp = $('#product_id').val();
            var name = $('#updateProductName').val();
            var description = $('#updateProductDescription').val();

            // Use Ajax to send product information to the Staff/Update action method
            $.ajax({
                url: "/Staff/Update?masp=" + masp + "&name=" + name + "&description=" + description,
                type: 'GET',
                headers: {
                    "Content-Type": "application/json",
                }
            });

            $('#updateModal').modal('hide');
            location.reload();
        });
    }*@

    function update() {
        $('#updateProductButton').click(function () {
            // Get product information from the modal form
            var masp = $('#product_id').val();
            var name = $('#updateProductName').val();
            var description = $('#updateProductDescription').val();

            // Use Ajax to send product information to the Staff/Update action method
            $.ajax({
                url: "/Staff/Update",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    masp: masp,
                    name: name,
                    description: description
                }),
                success: function () {
                    $('#updateModal').modal('hide');
                    location.reload();
                },
                error: function (error) {
                    console.error('Error updating product:', error);
                    // Xử lý lỗi nếu cần
                }
            });
        });
    }

</script>

